<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureBank AI Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .chat-container {
            width: 400px;
            height: 600px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .bank-logo {
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #4ade80;
            border-radius: 50%;
            animation: pulse 2s infinite;
            margin-left: 10px;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(74, 222, 128, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(74, 222, 128, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(74, 222, 128, 0);
            }
        }

        .chat-subtitle {
            font-size: 12px;
            opacity: 0.9;
            margin-top: 5px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }

        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            animation: fadeIn 0.3s ease-out;
            position: relative;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user-message {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }

        .bot-message {
            background: white;
            color: #333;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .timestamp {
            font-size: 10px;
            opacity: 0.7;
            margin-top: 5px;
        }

        .typing-indicator {
            display: none;
            align-self: flex-start;
            padding: 15px;
            background: white;
            border-radius: 18px;
            border-bottom-left-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .typing-indicator.show {
            display: block;
        }

        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #888;
            border-radius: 50%;
            margin: 0 2px;
            animation: typing 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.7;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        .chat-input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            outline: none;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .chat-input:focus {
            border-color: #667eea;
        }

        .send-button {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .send-button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .send-button:active {
            transform: scale(0.95);
        }

        .quick-actions {
            padding: 10px 20px;
            background: white;
            display: flex;
            gap: 8px;
            overflow-x: auto;
            border-top: 1px solid #e0e0e0;
        }

        .quick-action {
            padding: 8px 16px;
            background: #f0f0f0;
            border: none;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s;
        }

        .quick-action:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .welcome-message {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 14px;
        }

        @media (max-width: 480px) {
            .chat-container {
                width: 100%;
                height: 100%;
                border-radius: 0;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <div class="bank-logo">
                üè¶ SecureBank AI
                <span class="status-indicator"></span>
            </div>
            <div class="chat-subtitle">Your 24/7 Banking Assistant</div>
        </div>
        
        <div class="quick-actions">
            <button class="quick-action" onclick="sendQuickMessage('Check balance')">üí∞ Balance</button>
            <button class="quick-action" onclick="sendQuickMessage('Recent transactions')">üìä Transactions</button>
            <button class="quick-action" onclick="sendQuickMessage('Transfer money')">üí∏ Transfer</button>
            <button class="quick-action" onclick="sendQuickMessage('Find ATM')">üìç ATM</button>
            <button class="quick-action" onclick="sendQuickMessage('Help')">‚ùì Help</button>
        </div>
        
        <div class="chat-messages" id="chatMessages">
            <div class="welcome-message">
                <div style="font-size: 48px; margin-bottom: 10px;">üëã</div>
                Welcome to SecureBank! I'm here to help with all your banking needs.
            </div>
        </div>
        
        <div class="typing-indicator" id="typingIndicator">
            <span></span>
            <span></span>
            <span></span>
        </div>
        
        <div class="chat-input-container">
            <input 
                type="text" 
                class="chat-input" 
                id="chatInput" 
                placeholder="Type your message..."
                onkeypress="if(event.key==='Enter') sendMessage()"
            >
            <button class="send-button" onclick="sendMessage()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                </svg>
            </button>
        </div>
    </div>

    <script>
        const API_URL = 'https://4c1vpuut91.execute-api.us-east-1.amazonaws.com/dev/chat';
        let sessionId = 'session-' + Date.now() + Math.random().toString(36).substr(2, 9);

        // Conversation state for multi-step flows (used by offline fallback)
        let pendingAction = null;
        let transferAmount = 0;

        const ACCOUNTS = {
            checking: { balance: 5432.10, number: "****1234", type: "Premium Checking" },
            savings:  { balance: 15750.25, number: "****5678", type: "High-Yield Savings" },
            credit:   { balance: 2340.50, available: 7659.50, number: "****9012", type: "Rewards Card" }
        };

        const TRANSACTIONS = [
            { date: "Today",     desc: "Starbucks Coffee",        amount: -5.85 },
            { date: "Yesterday", desc: "Direct Deposit - Salary", amount: 3500.00 },
            { date: "Jan 13",    desc: "Amazon Purchase",         amount: -67.42 },
            { date: "Jan 12",    desc: "Transfer from Savings",   amount: 500.00 },
            { date: "Jan 11",    desc: "Walmart Grocery",         amount: -142.38 }
        ];

        function fmt(n) { return "$" + n.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ","); }

        function getDemoResponse(raw) {
            const msg = raw.toLowerCase();

            // Transfer flow: waiting for amount
            if (pendingAction === 'transfer_amount') {
                const match = raw.match(/\$?(\d+(?:\.\d{2})?)/);
                if (match) {
                    const amount = parseFloat(match[1]);
                    if (amount > ACCOUNTS.checking.balance) {
                        return "\u274C Insufficient funds. Your checking balance is " + fmt(ACCOUNTS.checking.balance) + ". Please enter a smaller amount or type 'cancel'.";
                    }
                    transferAmount = amount;
                    pendingAction = 'transfer_confirm';
                    return "\u{1F4B8} Ready to transfer " + fmt(amount) + " from Checking " + ACCOUNTS.checking.number + " to Savings " + ACCOUNTS.savings.number + ".\n\n\u26A0\uFE0F Please type 'confirm' to proceed or 'cancel' to stop.";
                }
                return "Please enter a valid amount (e.g., $100 or 100)";
            }

            // Transfer flow: waiting for confirmation
            if (pendingAction === 'transfer_confirm') {
                if (msg.includes('confirm')) {
                    const newChecking = ACCOUNTS.checking.balance - transferAmount;
                    const newSavings = ACCOUNTS.savings.balance + transferAmount;
                    const conf = Math.floor(100000 + Math.random() * 900000);
                    pendingAction = null;
                    return "\u2705 Transfer Successful!\n\n\u{1F4E4} From: Checking " + ACCOUNTS.checking.number + "\n\u{1F4E5} To: Savings " + ACCOUNTS.savings.number + "\n\u{1F4B5} Amount: " + fmt(transferAmount) + "\n\u{1F522} Confirmation: #" + conf + "\n\nNew Balances:\n- Checking: " + fmt(newChecking) + "\n- Savings: " + fmt(newSavings);
                }
                if (msg.includes('cancel')) { pendingAction = null; return "Transfer cancelled. How else can I help you?"; }
                return "Please type 'confirm' to complete the transfer or 'cancel' to stop.";
            }

            if (msg.includes('balance') || msg.includes('how much')) {
                if (msg.includes('savings'))
                    return "\u{1F4B0} Savings Account " + ACCOUNTS.savings.number + "\nBalance: " + fmt(ACCOUNTS.savings.balance) + "\n\nInterest earned this month: $47.25";
                if (msg.includes('credit'))
                    return "\u{1F4B3} Credit Card " + ACCOUNTS.credit.number + "\nCurrent Balance: " + fmt(ACCOUNTS.credit.balance) + "\nAvailable Credit: " + fmt(ACCOUNTS.credit.available) + "\nMinimum Payment Due: $35.00";
                return "\u{1F4B0} Your Account Balances:\n\n\u{1F3E6} Checking " + ACCOUNTS.checking.number + "\n   Balance: " + fmt(ACCOUNTS.checking.balance) + "\n\n\u{1F48E} Savings " + ACCOUNTS.savings.number + "\n   Balance: " + fmt(ACCOUNTS.savings.balance) + "\n\n\u{1F4B3} Credit Card " + ACCOUNTS.credit.number + "\n   Balance: " + fmt(ACCOUNTS.credit.balance) + "\n   Available: " + fmt(ACCOUNTS.credit.available);
            }

            if (msg.includes('transaction') || msg.includes('recent') || msg.includes('history')) {
                const lines = TRANSACTIONS.map(function(t) {
                    const sign = t.amount > 0 ? "(+" : "";
                    const end = t.amount > 0 ? ")" : "";
                    return "\u2022 " + t.date + ": " + t.desc + " " + sign + fmt(Math.abs(t.amount)) + end;
                }).join("\n");
                return "\u{1F4CA} Recent Transactions (Checking):\n\n" + lines + "\n\nCurrent Balance: " + fmt(ACCOUNTS.checking.balance);
            }

            if (msg.includes('transfer')) {
                pendingAction = 'transfer_amount';
                return "\u{1F4B8} Let's set up your transfer.\n\nHow much would you like to transfer from Checking to Savings?\n\n(Enter amount like $100 or just 100)";
            }

            if (msg.includes('atm') || msg.includes('branch')) {
                return "\u{1F4CD} Nearest ATM Locations:\n\n\u{1F4CD} SecureBank ATM - 123 Main St (0.3 miles)\n\u{1F4CD} Partner ATM - Walmart, 456 Oak Ave (0.8 miles)\n\u{1F4CD} SecureBank Branch - 789 Pine Rd (1.2 miles)\n\u{1F4CD} Partner ATM - 7-Eleven, 321 Elm St (1.5 miles)\n\n\u{1F4A1} Tip: SecureBank ATMs have no fees. Partner ATMs may charge $3.00";
            }

            if (msg.includes('pay') || msg.includes('bill')) {
                return "\u{1F4B3} Upcoming Bills:\n\n- Electricity - $142.50 (Due Jan 20)\n- Internet - $79.99 (Due Jan 22)\n- Credit Card - $35.00 (Min. payment due Jan 25)\n- Netflix - $15.99 (Auto-pay Jan 28)\n\nWould you like to pay any of these bills now?";
            }

            if (msg.includes('help')) {
                return "\u{1F91D} I can help you with:\n\n\u{1F4B0} Check balances - \"What's my balance?\"\n\u{1F4CA} View transactions - \"Show recent transactions\"\n\u{1F4B8} Transfer money - \"Transfer funds\"\n\u{1F4CD} Find ATMs - \"Where's the nearest ATM?\"\n\u{1F4B3} Pay bills - \"Show my bills\"\n\u{1F4DE} Support - \"Talk to support\"\n\u{1F510} Security - \"Is my account secure?\"\n\nJust type or click any quick action button above!";
            }

            if (msg.includes('hello') || msg.includes('hi')) {
                const h = new Date().getHours();
                const g = h < 12 ? "Good morning" : h < 18 ? "Good afternoon" : "Good evening";
                return g + "! \u{1F44B} Welcome to SecureBank. How can I assist you today?";
            }

            if (msg.includes('thank')) {
                return "You're welcome! \u{1F60A} Is there anything else I can help you with today?";
            }

            if (msg.includes('secure') || msg.includes('safe') || msg.includes('security')) {
                return "\u{1F510} Your Security Status:\n\n\u2705 256-bit encryption active\n\u2705 Two-factor authentication enabled\n\u2705 Last login: Today at 2:15 PM from this device\n\u2705 No suspicious activity detected\n\nYour account is fully protected. If you notice anything unusual, type 'report fraud' immediately.";
            }

            return "I'd be happy to help! You said: '" + raw + "'\n\nTry asking about:\n\u2022 Account balance\n\u2022 Recent transactions\n\u2022 Transfer money\n\u2022 Find ATM\n\nOr click the quick action buttons above!";
        }

        function formatTime() {
            const now = new Date();
            return now.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function addMessage(text, isUser) {
            const messagesDiv = document.getElementById('chatMessages');

            // Remove welcome message if it exists
            const welcomeMsg = messagesDiv.querySelector('.welcome-message');
            if (welcomeMsg) {
                welcomeMsg.style.opacity = '0';
                setTimeout(() => welcomeMsg.remove(), 300);
            }

            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ' + (isUser ? 'user-message' : 'bot-message');
            messageDiv.style.whiteSpace = 'pre-wrap';

            messageDiv.innerHTML = text.replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\n/g, '<br>') +
                '<div class="timestamp">' + formatTime() + '</div>';

            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function showTypingIndicator() {
            document.getElementById('typingIndicator').classList.add('show');
            const messagesDiv = document.getElementById('chatMessages');
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').classList.remove('show');
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();

            if (!message) return;

            addMessage(message, true);
            input.value = '';

            showTypingIndicator();

            // Try API first, fall back to local demo responses
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: message, sessionId: sessionId })
                });

                if (!response.ok) throw new Error('API returned ' + response.status);

                const data = await response.json();
                setTimeout(function() {
                    hideTypingIndicator();
                    addMessage(data.response || getDemoResponse(message), false);
                }, 500);
            } catch (error) {
                // API unavailable - use offline demo responses
                const fallback = getDemoResponse(message);
                setTimeout(function() {
                    hideTypingIndicator();
                    addMessage(fallback, false);
                }, 800);
            }
        }

        function sendQuickMessage(message) {
            document.getElementById('chatInput').value = message;
            sendMessage();
        }

        window.onload = () => {
            document.getElementById('chatInput').focus();
        };
    </script>
</body>
</html>

